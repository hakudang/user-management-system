# バリデーション仕様書（Validation Specification）

本書は、ユーザー管理システムにおける入力値の検証要件を定義する。  
画面（User Create / User Edit / Registration Form）で入力された値が適切であることを保証し、  
不正データのDB登録を防止することを目的とする。

---

## 1. バリデーション要件一覧（Validation Rules Summary）

| 項目名 | 必須 | 形式・制約 | 備考 |
|--------|------|------------|------|
| 氏名（name） | 必須 | 最大255文字 | 全角・半角問わず |
| メールアドレス（email） | 必須 | 最大255文字、有効なメール形式 | 重複禁止（ユニーク） |
| パスワード（password） | 必須 | 8〜32文字、英大文字・英小文字・数字・記号を含む | ハッシュ化して保存 |
| 電話番号（phone_number） | 必須 | 数字＋ハイフンのみ、最大13文字、`000-0000-0000` 形式 | 国際形式は別途拡張可 |
| 住所（address） | 任意 | 最大255文字 | - |
| 性別（gender） | 任意 | `male` / `female` | ENUM |
| 生年月日（date_of_birth） | 任意 | `YYYY-MM-DD` 形式、日付として有効、未来日禁止 | - |
| 作成日時（created_at） | システム | 日時 | 自動生成 |
| 更新日時（updated_at） | システム | 日時 | 自動更新 |

---

## 2. バリデーション詳細仕様（Detailed Validation Rules）

### 2.1 必須チェック（Required Check）
- name が未入力でないこと  
- email が未入力でないこと  
- password が未入力でないこと  
- phone_number が未入力でないこと  

---

### 2.2 文字数チェック（Length Check）

| 項目 | 制限 | エラー例 |
|------|------|----------|
| name | 255文字以内 | 「氏名は255文字以内で入力してください。」 |
| email | 255文字以内 | 「メールアドレスは255文字以内で入力してください。」 |
| phone_number | 13文字以内 | 「電話番号は13文字以内で入力してください。」 |
| address | 255文字以内 | 「住所は255文字以内で入力してください。」 |

---

### 2.3 メール形式チェック（Email Format）

**条件**
- email 正規表現に一致すること  
  例: `^[^@\s]+@[^@\s]+\.[^@\s]+$`
- DB上でユニーク（重複不可）

---

### 2.4 パスワードチェック（Password Validation）

**条件**
- 8〜32文字  
- 英大文字・英小文字・数字・記号をすべて含む  

**正規表現例**
```
^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,32}$
```

---

### 2.5 電話番号チェック（Phone Number Format）

**条件**
- 数字＋ハイフンのみ許可  
- 形式：`000-0000-0000`

**正規表現例**
```
^\d{2,4}-\d{2,4}-\d{3,4}$
```

---

### 2.6 性別（Gender）

**条件**
- 空または `male` / `female`

---

### 2.7 生年月日（Date of Birth）

**条件**
- `YYYY-MM-DD` 形式  
- 実在する日付であること  
- 未来日の禁止  

---

## 3. バリデーションエラーの扱い（Error Handling）

### 3.1 エラーメッセージ表示
- フィールド直下または画面上部に表示  
- 複数エラーはすべて表示  

### 3.2 API利用時レスポンス例
HTTPステータス: 422

```json
{
  "errors": {
    "email": ["メールアドレスは既に登録されています。"],
    "password": ["英大文字・小文字・数字・記号を含めてください。"]
  }
}
```

---

## 4. テスト観点（Validation Test Points）

| テスト項目 | 内容 |
|------------|------|
| 必須項目未入力 | name, email, password, phone_number が空 |
| 最大文字数超過 | 上限確認 |
| メール形式異常 | 「@なし」「.なし」など |
| パスワード形式異常 | 必須構成要素欠落 |
| 電話番号形式異常 | ハイフンなし・桁不正 |
| ENUM不正値 | gender に無効値 |
| 日付の不正 | 未来日・存在しない日付 |

---
## 5. Change History

| Version | 日付       | 内容                    | 担当 |
|---------|------------|-------------------------|------|
| 1.0     | 2025-12-09 | 初版作成（バリデーション仕様書） | DANG |